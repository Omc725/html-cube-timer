<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cube Timer PWA</title>
    
    <!-- === PWA Meta Etiketleri === -->
    <meta name="theme-color" content="#191a1c"/>
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="manifest" href="manifest.json">

    <!-- === CSS Kodları Başlangıcı === -->
    <style>
        :root {
            --bg-dark: #1f2023; --bg-main: #27282c; --bg-sidebar: #191a1c;
            --bg-widget: #2d2e32; --text-primary: #e2e2e2; --text-secondary: #9a9a9a;
            --border-color: #3a3b40; --accent-blue: #3c82f6; --accent-green: #34d399;
            --accent-red: #ef4444; --yellow: #eab308;
            --list-item-odd-bg: #333438;
        }
        *, *::before, *::after { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: var(--text-primary); margin: 0; overflow: hidden; }
        .container { display: flex; height: 100vh; }
        .sidebar { width: 240px; background-color: var(--bg-sidebar); border-right: 1px solid var(--border-color); padding: 30px 20px; display: flex; flex-direction: column; }
        .sidebar h1 { font-size: 1.5em; margin: 0 0 40px 10px; }
        .sidebar nav a { display: block; color: var(--text-secondary); text-decoration: none; padding: 15px 20px; border-radius: 8px; margin-bottom: 10px; font-size: 1.1em; font-weight: 500; transition: all 0.2s; }
        .sidebar nav a:hover { background-color: var(--bg-widget); color: var(--text-primary); }
        .sidebar nav a.active { background-color: var(--accent-blue); color: white; }
        .main-content { flex-grow: 1; background-color: var(--bg-main); display: flex; flex-direction: column; }
        .view { display: none; height: 100%; }
        .view.active { display: flex; flex-direction: column; }
        #timer-view { padding: 20px 40px; }
        .timer-main { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .scramble-container { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 30px; }
        #scramble { font-size: 1.5em; color: var(--text-secondary); padding: 0 20px; line-height: 1.5; }
        #new-scramble-btn { background: none; border: none; font-size: 1.8em; color: var(--text-secondary); cursor: pointer; transition: color 0.2s; }
        #timer { font-size: min(12vw, 150px); font-weight: 600; margin: 20px 0; color: var(--text-primary); }
        .timer-details { display: grid; grid-template-columns: 2fr 1.5fr 1fr; gap: 20px; width: 100%; padding: 20px 0; }
        .solves-container { background-color: var(--bg-widget); padding: 15px; border-radius: 8px; max-height: 250px; display: flex; flex-direction: column; }
        .solves-container h3 { margin: 0 0 10px 5px; font-weight: 500;}
        #solves-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; }
        #solves-list li { display: flex; justify-content: space-between; align-items: center; padding: 8px 10px; border-radius: 5px; cursor: pointer; transition: background-color 0.2s; }
        #solves-list li:nth-child(odd) { background-color: var(--list-item-odd-bg); }
        #solves-list li:hover { background-color: #444549; }
        .delete-btn { background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 1.2em; z-index: 5; }
        .stats-box { background-color: var(--bg-widget); border-radius: 8px; padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .stat-item { text-align: center; } .stat-item .label { font-size: 0.9em; color: var(--text-secondary); } .stat-item .value { font-size: 1.3em; font-weight: 500; } .stat-item.best .value { color: var(--accent-green); }
        .cube-visualization { display: grid; grid-template-columns: repeat(12, 16px); grid-template-rows: repeat(9, 16px); margin: auto; }
        .sticker { width: 16px; height: 16px; border: 1.5px solid var(--bg-main); border-radius: 2px; }
        #stats-view { padding: 20px 40px; overflow-y: auto; }
        #stats-view h2 { border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .widget { background-color: var(--bg-widget); padding: 20px; border-radius: 8px; }
        .widget h3 { margin-top: 0; } .widget .value { font-size: 2em; font-weight: 600; } .widget.best .value { color: var(--accent-green); }
        .chart-container { margin-top: 30px; height: 400px; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); backdrop-filter: blur(5px); justify-content: center; align-items: center; }
        .modal-content { background-color: #2d2e32; padding: 30px; border-radius: 12px; border: 1px solid var(--border-color); width: 90%; max-width: 500px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
        #modal-time { font-size: 2.5em; font-weight: 600; margin-bottom: 15px; }
        #modal-scramble { font-size: 1.1em; color: var(--text-secondary); word-wrap: break-word; line-height: 1.6; background-color: #27282c; padding: 10px; border-radius: 5px; }
        #modal-date { font-size: 0.9em; color: var(--text-secondary); margin-top: 20px; }
        #modal-cube-net { margin: 25px auto; } #modal-cube-net .sticker { border-color: #2d2e32; }
        #modal-close { margin-top: 20px; padding: 10px 20px; cursor: pointer; border: none; background-color: var(--accent-blue); color: white; border-radius: 5px; font-size: 1em; }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar"><nav id="nav-menu">
            <h1>Cube Timer</h1>
            <a href="#" class="nav-link active" data-view="timer-view">Zamanlayıcı</a>
            <a href="#" class="nav-link" data-view="stats-view">İstatistikler</a>
        </nav></aside>
        <main class="main-content">
            <div id="timer-view" class="view active">
                <div class="timer-main"><div class="scramble-container"><p id="scramble">Yükleniyor...</p><button id="new-scramble-btn" title="Yeni Karıştırma">⟳</button></div><h1 id="timer">0.00</h1></div>
                <div class="timer-details">
                    <div class="solves-container"><h3>Son Çözümler</h3><ul id="solves-list"></ul></div>
                    <div class="stats-box"><div class="stat-item best"><div class="label">En İyi</div><div class="value" id="best-time">-</div></div><div class="stat-item"><div class="label">Ao5</div><div class="value" id="ao5">-</div></div><div class="stat-item"><div class="label">En Kötü</div><div class="value" id="worst-time">-</div></div><div class="stat-item"><div class="label">Ao12</div><div class="value" id="ao12">-</div></div></div>
                    <div class="cube-visualization" id="cube-net"></div>
                </div>
            </div>
            <div id="stats-view" class="view">
                <h2>İstatistikler</h2>
                <div class="stats-grid"><div class="widget best"><h3>En İyi Süre (PB)</h3><p class="value" id="stats-pb">-</p></div><div class="widget"><h3>Toplam Çözüm</h3><p class="value" id="stats-total">-</p></div><div class="widget"><h3>Ortalama Süre</h3><p class="value" id="stats-mean">-</p></div></div>
                <div class="chart-container widget"><h3>Çözüm Süreleri Grafiği</h3><canvas id="solves-chart"></canvas></div>
            </div>
        </main>
    </div>
    <div id="solve-details-modal" class="modal"><div class="modal-content"><h2 id="modal-time"></h2><div class="cube-visualization" id="modal-cube-net"></div><p id="modal-scramble"></p><p id="modal-date"></p><button id="modal-close">Kapat</button></div></div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        let timerInterval, time=0, isRunning=false, readyToStart=false, solves=[], currentScramble='', chartInstance=null;
        const navMenu=document.getElementById('nav-menu'), timerEl=document.getElementById('timer'), scrambleEl=document.getElementById('scramble');
        const solvesListEl=document.getElementById('solves-list'), cubeNetEl=document.getElementById('cube-net'), chartCanvas=document.getElementById('solves-chart');
        const newScrambleBtn=document.getElementById('new-scramble-btn');
        const modal=document.getElementById('solve-details-modal'), modalCloseBtn=document.getElementById('modal-close'), modalCubeNet=document.getElementById('modal-cube-net');
        const colors={W:'#fefefe',G:'#34d399',R:'#ef4444',B:'#3c82f6',O:'#f97316',Y:'#eab308'};
        function createSolvedState(){return[...Array(9).fill('W'),...Array(9).fill('O'),...Array(9).fill('G'),...Array(9).fill('R'),...Array(9).fill('B'),...Array(9).fill('Y')]}
        const stickerMap={U:[0,1,2,3,4,5,6,7,8],L:[9,10,11,12,13,14,15,16,17],F:[18,19,20,21,22,23,24,25,26],R:[27,28,29,30,31,32,33,34,35],B:[36,37,38,39,40,41,42,43,44],D:[45,46,47,48,49,50,51,52,53]};
        const adjacentMap={U:[38,37,36,29,28,27,20,19,18,11,10,9],D:[15,16,17,24,25,26,33,34,35,42,43,44],F:[6,7,8,27,30,33,47,46,45,15,12,9],B:[2,1,0,17,14,11,51,52,53,29,32,35],L:[0,3,6,18,21,24,45,48,51,44,41,38],R:[8,5,2,36,39,42,53,50,47,26,23,20]};
        function rotate(state,face,modifier){const fS=stickerMap[face],aS=adjacentMap[face],t=modifier==="'"?3:(modifier==="2"?2:1);for(let i=0;i<t;i++){const nF=[...fS.map(idx=>state[idx])],rF=[nF[6],nF[3],nF[0],nF[7],nF[4],nF[1],nF[8],nF[5],nF[2]];fS.forEach((idx,j)=>state[idx]=rF[j]);const nA=aS.slice(0,3).map(idx=>state[idx]);for(let j=0;j<9;j++){state[aS[j]]=state[aS[j+3]]}aS.slice(9).forEach((idx,j)=>state[idx]=nA[j])}return state}
        function applyScramble(scrambleStr){let state=createSolvedState();scrambleStr.split(' ').filter(m=>m).forEach(move=>state=rotate(state,move[0],move.length>1?move[1]:''));return state}
        function createCubeNetHTML(container){const l={U:{r:1,c:4,f:0},L:{r:4,c:1,f:1},F:{r:4,c:4,f:2},R:{r:4,c:7,f:3},B:{r:4,c:10,f:4},D:{r:7,c:4,f:5}};container.innerHTML='';for(const f in l){for(let i=0;i<3;i++){for(let j=0;j<3;j++){const s=document.createElement('div');s.classList.add('sticker');s.style.gridRow=l[f].r+i;s.style.gridColumn=l[f].c+j;s.id=`${container.id}-s-${l[f].f*9+(i*3+j)}`;container.appendChild(s)}}}}
        function drawCubeNet(container,state){for(let i=0;i<54;i++){const s=document.getElementById(`${container.id}-s-${i}`);if(s)s.style.backgroundColor=colors[state[i]]}}
        function formatTime(ms){if(ms===Infinity||isNaN(ms)||ms===null)return'-';return(ms/1000).toFixed(2)}
        function startTimer(){time=0;isRunning=true;timerEl.style.color='var(--text-primary)';const sT=Date.now();timerInterval=setInterval(()=>{time=Date.now()-sT;timerEl.textContent=formatTime(time)},10)}
        function stopTimer(){isRunning=false;clearInterval(timerInterval);addSolve({time,scramble:currentScramble,date:new Date().toISOString()});generateNewScramble()}
        function addSolve(solveData){solves.unshift(solveData);updateAll()}
        function deleteSolve(index){solves.splice(index,1);updateAll()}
        function renderSolves(){solvesListEl.innerHTML='';solves.slice(0,100).forEach((solve,index)=>{const li=document.createElement('li');li.dataset.index=index;li.innerHTML=`<span>${solves.length-index}. ${formatTime(solve.time)}</span> <button class="delete-btn" title="Sil">🗑️</button>`;solvesListEl.appendChild(li)})}
        function updateTimerViewStats(){const times=solves.map(s=>s.time);document.getElementById('best-time').textContent=formatTime(solves.length?Math.min(...times):null);document.getElementById('worst-time').textContent=formatTime(solves.length?Math.max(...times):null);document.getElementById('ao5').textContent=formatTime(calculateAverage(5,solves));document.getElementById('ao12').textContent=formatTime(calculateAverage(12,solves))}
        function updateStatsView(){const times=solves.map(s=>s.time);document.getElementById('stats-pb').textContent=formatTime(solves.length?Math.min(...times):null);document.getElementById('stats-total').textContent=solves.length;const mean=solves.length?times.reduce((a,b)=>a+b,0)/solves.length:null;document.getElementById('stats-mean').textContent=formatTime(mean);drawChart()}
        function updateAll(){saveSolves();renderSolves();updateTimerViewStats();if(document.getElementById('stats-view').classList.contains('active')){updateStatsView()}}
        function calculateAverage(count,list){if(list.length<count)return null;const times=list.slice(0,count).map(s=>s.time).sort((a,b)=>a-b).slice(1,-1);return times.reduce((a,b)=>a+b,0)/times.length}
        function generateNewScramble(){const m=["U","D","L","R","F","B"],d=["","'","2"];let s="",l="";for(let i=0;i<21;i++){let v,a,p=getAxis(l);do{v=m[Math.floor(Math.random()*m.length)];a=getAxis(v)}while(a===p);s+=v+d[Math.floor(Math.random()*d.length)]+" ";l=v}currentScramble=s.trim();scrambleEl.textContent=currentScramble;drawCubeNet(cubeNetEl,applyScramble(currentScramble))}
        function getAxis(move){if(['U','D'].includes(move))return'Y';if(['L','R'].includes(move))return'X';if(['F','B'].includes(move))return'Z';return null}
        function setupEventListeners(){document.addEventListener('keydown',e=>{if(e.code==='Space'&&modal.style.display!=='flex'){e.preventDefault();if(isRunning)stopTimer();else if(!readyToStart){timerEl.textContent='0.00';timerEl.style.color='var(--accent-red)';readyToStart=true}}});document.addEventListener('keyup',e=>{if(e.code==='Space'&&modal.style.display!=='flex'){if(!isRunning&&readyToStart){timerEl.style.color='var(--accent-green)';startTimer()}readyToStart=false}});newScrambleBtn.addEventListener('click',generateNewScramble);solvesListEl.addEventListener('click',e=>{const li=e.target.closest('li');if(!li)return;const index=parseInt(li.dataset.index);if(e.target.classList.contains('delete-btn')){e.stopPropagation();deleteSolve(index)}else{showSolveDetails(index)}});navMenu.addEventListener('click',e=>{e.preventDefault();if(e.target.classList.contains('nav-link')){document.querySelector('.nav-link.active').classList.remove('active');document.querySelector('.view.active').classList.remove('active');e.target.classList.add('active');const viewId=e.target.dataset.view;document.getElementById(viewId).classList.add('active');if(viewId==='stats-view')updateStatsView()}});modalCloseBtn.addEventListener('click',()=>modal.style.display='none');window.addEventListener('click',e=>{if(e.target===modal)modal.style.display='none'});}
        function showSolveDetails(index){const solve=solves[index];document.getElementById('modal-time').textContent=formatTime(solve.time);document.getElementById('modal-scramble').textContent=solve.scramble;document.getElementById('modal-date').textContent=new Date(solve.date).toLocaleString('tr-TR');drawCubeNet(modalCubeNet,applyScramble(solve.scramble));modal.style.display='flex'}
        function drawChart(){if(chartInstance)chartInstance.destroy();const labels=solves.map((_,i)=>solves.length-i).reverse();const data=solves.map(s=>s.time/1000).reverse();chartInstance=new Chart(chartCanvas,{type:'line',data:{labels,datasets:[{label:'Çözüm Süresi (s)',data,borderColor:'var(--accent-blue)',tension:0.1}]},options:{responsive:true,maintainAspectRatio:false}})}
        function saveSolves(){localStorage.setItem('cubeTimerSolves_final_pwa',JSON.stringify(solves))}
        function loadSolves(){const saved=localStorage.getItem('cubeTimerSolves_final_pwa');if(saved){solves=JSON.parse(saved)}}
        function init(){createCubeNetHTML(cubeNetEl);createCubeNetHTML(modalCubeNet);loadSolves();generateNewScramble();updateAll();setupEventListeners()}
        init();

        // PWA Service Worker Kaydı
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registration successful');
                }).catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    });
    </script>
</body>
</html>
